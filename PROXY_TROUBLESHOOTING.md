# КРИТИЧЕСКАЯ ПРОБЛЕМА: Прокси не используется!

## Обнаруженные проблемы:

### 1. **Прокси настраивается, но может не работать**

Код в `telethon_helper.py` выглядит правильно, НО:
- Нужно убедиться, что библиотека `PySocks` установлена
- Нужно проверить, что прокси действительно используется

### 2. **Мобильные прокси с ротацией IP**

Вы используете мобильные прокси, которые меняют IP каждые 20-30 минут.
**ПРОБЛЕМА**: В базе хранится статичный IP, но реальный IP прокси постоянно меняется.

Это нормально! Главное - чтобы **адрес прокси** (host:port) оставался тем же.

## Как проверить, что прокси работает:

### Шаг 1: Установите зависимости

```bash
cd ~/mrktguru
pip3 install PySocks aiohttp-socks
```

### Шаг 2: Запустите тест прокси

```bash
python3 test_proxy.py <account_id>
```

Например:
```bash
python3 test_proxy.py 1
```

Этот скрипт покажет:
- IP сервера (без прокси)
- IP через прокси
- Подключается ли Telethon

### Шаг 3: Проверьте логи

```bash
journalctl -u mrktguru-web -n 100 | grep "Using proxy"
```

Должны видеть:
```
✅ Using proxy for account X: host:port (type: socks5)
```

## Почему аккаунты могли быть удалены:

### Вероятные причины:

1. **Прокси НЕ используется** ❌
   - Все подключения идут с IP сервера
   - Telegram видит множество аккаунтов с одного IP
   - Автоматический бан

2. **PySocks не установлен** ❌
   - Telethon игнорирует proxy параметр
   - Подключается напрямую

3. **Неправильный формат прокси** ❌
   - Если username/password содержат спецсимволы
   - Если порт неверный

4. **Прокси не работает** ❌
   - Прокси сервер недоступен
   - Неправильные credentials

## Что делать СРОЧНО:

### 1. Проверьте PySocks:

```bash
python3 -c "import socks; print('PySocks installed:', socks.SOCKS5)"
```

Если ошибка:
```bash
pip3 install PySocks
```

### 2. Запустите тест:

```bash
cd ~/mrktguru
git pull origin antigravity_v02
python3 test_proxy.py 1
```

### 3. Проверьте результат:

Если видите:
```
✅ PROXY IS WORKING - Different from server IP
```
→ Прокси работает!

Если видите:
```
❌ PROXY NOT WORKING - Same as server IP!
```
→ Прокси НЕ работает! Все идет через сервер!

## Временное решение:

**НЕ ДОБАВЛЯЙТЕ новые аккаунты** пока не убедитесь, что прокси работает!

Для существующих аккаунтов:
1. Убедитесь, что прокси назначен
2. Запустите тест
3. Если прокси не работает - исправьте
4. Только потом включайте warmup

## Проверка мобильных прокси:

Для ротирующихся прокси:
```bash
# Запустите несколько раз с интервалом
python3 test_proxy.py 1
# Подождите 5 минут
python3 test_proxy.py 1
# Подождите еще 5 минут
python3 test_proxy.py 1
```

IP должен меняться - это нормально!
Главное - чтобы он был **разный** от IP сервера.

## Следующие шаги:

1. ✅ Установить PySocks
2. ✅ Запустить test_proxy.py
3. ✅ Проверить результаты
4. ✅ Если прокси не работает - сообщить результаты теста
5. ✅ Исправить проблему
6. ✅ Только потом добавлять новые аккаунты

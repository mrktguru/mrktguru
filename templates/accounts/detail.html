{% extends "base.html" %}

{% block title %}Account {{ account.phone }} - Telegram System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Account: {{ account.phone }}</h1>
    <div>
        <a href="{{ url_for('dashboard.index') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0">Account Status</h5>
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-5">Status:</dt>
                    <dd class="col-sm-7">
                        {% if account.status == 'active' %}
                        <span class="badge bg-success">{{ account.status }}</span>
                        {% elif account.status == 'warming_up' %}
                        <span class="badge bg-warning">{{ account.status }}</span>
                        {% elif account.status == 'cooldown' %}
                        <span class="badge bg-info">{{ account.status }}</span>
                        {% else %}
                        <span class="badge bg-danger">{{ account.status }}</span>
                        {% endif %}
                    </dd>

                    <dt class="col-sm-5">Health:</dt>
                    <dd class="col-sm-7">
                        <div class="progress">
                            <div class="progress-bar {% if account.health_score >= 70 %}bg-success{% elif account.health_score >= 40 %}bg-warning{% else %}bg-danger{% endif %}"
                                style="width: {{ account.health_score }}%">
                                {{ account.health_score }}%
                            </div>
                        </div>
                    </dd>

                    <dt class="col-sm-5">Created:</dt>
                    <dd class="col-sm-7">{{ account.created_at.strftime('%Y-%m-%d') }}</dd>

                    <dt class="col-sm-5">Last Activity:</dt>
                    <dd class="col-sm-7">
                        {% if account.last_activity %}
                        {{ account.last_activity.strftime('%Y-%m-%d %H:%M') }}
                        {% else %}
                        <span class="text-muted">Never</span>
                        {% endif %}
                    </dd>

                    <dt class="col-sm-5">Cooldown Until:</dt>
                    <dd class="col-sm-7">
                        {% if account.cooldown_until %}
                        {{ account.cooldown_until.strftime('%Y-%m-%d %H:%M') }}
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </dd>
                </dl>

                <div class="d-grid gap-2 mt-3">
                    <!-- Original Verify Session for TData setup -->
                    <form method="POST" action="{{ url_for('accounts.verify', account_id=account.id) }}">
                        <button type="submit" class="btn btn-success w-100">
                            <i class="bi bi-check-circle"></i> Verify Session
                        </button>
                    </form>

                    <!-- Safe Health Check Dropdown -->
                    <div class="btn-group w-100" role="group">
                        <button type="button" class="btn btn-outline-success dropdown-toggle w-100"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-heart-pulse"></i> Check Account Health
                        </button>
                        <ul class="dropdown-menu w-100">
                            <li>
                                <h6 class="dropdown-header">Choose Check Method</h6>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="checkAccountHealth('self_check'); return false;">
                                    <span class="badge bg-success me-2">‚≠ê Safest</span>
                                    <strong>Self-Check</strong>
                                    <br><small class="text-muted">Via Saved Messages ‚Ä¢ ~5-10s ‚Ä¢ Best for new
                                        accounts</small>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"
                                    onclick="checkAccountHealth('public_channel'); return false;">
                                    <span class="badge bg-info me-2">‚≠ê Safe</span>
                                    <strong>Public Channel</strong>
                                    <br><small class="text-muted">Read @telegram ‚Ä¢ ~3-5s ‚Ä¢ Daily checks</small>
                                </a>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" onclick="checkAccountHealth('get_me'); return false;">
                                    <span class="badge bg-warning me-2">‚≠ê‚≠ê Moderate</span>
                                    <strong>Get Me</strong>
                                    <br><small class="text-muted">With delays ‚Ä¢ ~10-25s ‚Ä¢ Max 1 per 2-3h</small>
                                </a>
                            </li>
                        </ul>
                    </div>

                    <form method="POST" action="{{ url_for('accounts.sync_from_telegram', account_id=account.id) }}">
                        <button type="submit" class="btn btn-outline-primary w-100"
                            title="Sync profile data from Telegram (cooldown: 5 min)">
                            <i class="bi bi-arrow-repeat"></i> Sync from Telegram
                            {% if account.last_sync_at %}
                            <br><small class="text-muted">Last: {{ account.last_sync_at.strftime('%H:%M') }}</small>
                            {% endif %}
                        </button>
                    </form>

                    <a href="{{ url_for('accounts.activity_logs', account_id=account.id) }}"
                        class="btn btn-outline-info w-100">
                        <i class="bi bi-list-ul"></i> View Activity Logs
                    </a>
                </div>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0">Daily Stats</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h3>{{ account.messages_sent_today }}</h3>
                        <small class="text-muted">Messages</small>
                    </div>
                    <div class="col-6">
                        <h3>{{ account.invites_sent_today }}</h3>
                        <small class="text-muted">Invites</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">
                <!-- Telegram User Info Card - Insert after Account Status card -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-telegram"></i> Telegram User Info</h5>
                    </div>
                    <div class="card-body">
                        {% if account.telegram_id %}
                        <div class="row mb-3">
                            <div class="col-md-4 text-center">
                                {% if account.photo_url and account.photo_url != "photo_available" %}
                                <img src="/{{ account.photo_url }}" class="rounded-circle mb-2" width="100" height="100"
                                    style="object-fit: cover;">
                                {% else %}
                                <div class="bg-secondary rounded-circle d-inline-flex align-items-center justify-content-center"
                                    style="width: 100px; height: 100px;">
                                    <i class="bi bi-person-fill text-white" style="font-size: 3rem;"></i>
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-8">
                                <dl class="row mb-0">
                                    <dt class="col-sm-4">ID:</dt>
                                    <dd class="col-sm-8"><code>{{ account.telegram_id }}</code></dd>

                                    <dt class="col-sm-4">Name:</dt>
                                    <dd class="col-sm-8">
                                        {{ account.first_name }}
                                        {% if account.last_name %}{{ account.last_name }}{% endif %}
                                    </dd>

                                    <dt class="col-sm-4">Username:</dt>
                                    <dd class="col-sm-8">
                                        {% if account.username %}
                                        @{{ account.username }}
                                        {% else %}
                                        <span class="text-muted">No username</span>
                                        {% endif %}
                                    </dd>

                                    <dt class="col-sm-4">Bio:</dt>
                                    <dd class="col-sm-8">
                                        {% if account.bio %}
                                        {{ account.bio }}
                                        {% else %}
                                        <span class="text-muted">No bio</span>
                                        {% endif %}
                                    </dd>
                                </dl>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="d-flex justify-content-between align-items-center">
                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse"
                                data-bs-target="#editProfile">
                                <i class="bi bi-pencil"></i> Edit Profile
                            </button>

                            <button class="btn btn-sm btn-outline-secondary" onclick="syncProfile()" id="sync-btn"
                                title="Sync profile data from Telegram (human-like)">
                                <i class="bi bi-arrow-repeat"></i> Sync Profile
                            </button>
                        </div>

                        <div class="collapse mt-3" id="editProfile">
                            <form method="POST" action="{{ url_for('accounts.update_profile', account_id=account.id) }}"
                                enctype="multipart/form-data">
                                <div class="mb-2">
                                    <label class="form-label">Username</label>
                                    <input type="text" name="username" class="form-control"
                                        value="{{ account.username or "" }}" placeholder="username (without @)">
                                    <small class="text-muted">Enter without @ symbol</small>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label">Bio</label>
                                    <textarea name="bio" class="form-control" rows="3"
                                        placeholder="About me">{{ account.bio or "" }}</textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Profile Photo</label>
                                    <input type="file" name="photo" class="form-control" accept="image/*">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save"></i> Save Changes
                                </button>
                            </form>
                        </div>
                        {% else %}
                        <div class="alert alert-info mb-0">
                            <i class="bi bi-info-circle"></i> Click "Verify Session" button above to load Telegram user
                            info
                        </div>
                        {% endif %}
                    </div>
                </div>

                <h5 class="mb-0">Warm-up Progress</h5>
            </div>
            <div class="card-body">
                <div class="progress mb-2" style="height: 25px;">
                    <div class="progress-bar"
                        style="width: {{ ((account.warm_up_days_completed or 0) / 7 * 100)|int }}%">
                        {{ account.warm_up_days_completed or 0 }}/7 days
                    </div>
                </div>
                {% if (account.warm_up_days_completed or 0) < 7 %} <small class="text-muted">
                    {{ 7 - (account.warm_up_days_completed or 0) }} days remaining
                    </small>
                    {% else %}
                    <small class="text-success">‚úì Warm-up completed</small>
                    {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0">Device Profile</h5>
            </div>
            <div class="card-body">
                {% if account.tdata_metadata %}
                <dl class="row mb-0">
                    <dt class="col-sm-4">Device Model:</dt>
                    <dd class="col-sm-8">{{ account.tdata_metadata.device_model or 'N/A' }}</dd>

                    <dt class="col-sm-4">System Version:</dt>
                    <dd class="col-sm-8">{{ account.tdata_metadata.system_version or 'N/A' }}</dd>

                    <dt class="col-sm-4">App Version:</dt>
                    <dd class="col-sm-8">{{ account.tdata_metadata.app_version or 'N/A' }}</dd>

                    <dt class="col-sm-4">Language:</dt>
                    <dd class="col-sm-8">{{ account.tdata_metadata.lang_code or 'N/A' }} / {{
                        account.tdata_metadata.system_lang_code or 'N/A' }}</dd>
                </dl>
                {% elif account.device_profile %}
                <dl class="row mb-0">
                    <dt class="col-sm-4">Device Model:</dt>
                    <dd class="col-sm-8">{{ account.device_profile.device_model }}</dd>

                    <dt class="col-sm-4">System Version:</dt>
                    <dd class="col-sm-8">{{ account.device_profile.system_version }}</dd>

                    <dt class="col-sm-4">App Version:</dt>
                    <dd class="col-sm-8">{{ account.device_profile.app_version }}</dd>

                    <dt class="col-sm-4">Language:</dt>
                    <dd class="col-sm-8">{{ account.device_profile.lang_code }} / {{
                        account.device_profile.system_lang_code }}</dd>
                </dl>
                {% else %}
                <p class="text-muted">No device profile</p>
                {% endif %}
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Proxy Assignment</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('accounts.assign_proxy', account_id=account.id) }}">
                    <div class="row">
                        <div class="col-md-9">
                            <select class="form-select" name="proxy_id">
                                <option value="">No proxy</option>
                                {% for proxy in proxies %}
                                <option value="{{ proxy.id }}" {% if account.proxy_id==proxy.id %}selected{% endif %}>
                                    {% if proxy.country %}üåç {{ proxy.country }} - {% endif %}{{ proxy.type }}://{{
                                    proxy.host }}:{{ proxy.port }}
                                    {% if proxy.current_ip %}({{ proxy.current_ip }}){% endif %}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-primary w-100">Update</button>
                        </div>
                    </div>
                </form>

                {% if account.proxy %}
                <div class="mt-3 p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <strong>Current Proxy:</strong><br>
                            {% if account.proxy.country %}<span class="badge bg-info">üåç {{ account.proxy.country
                                }}</span> {% endif %}
                            Type: {{ account.proxy.type }}<br>
                            Host: {{ account.proxy.host }}:{{ account.proxy.port }}<br>
                            IP: <span id="proxy-ip">{{ account.proxy.current_ip or 'Unknown' }}</span>
                            <button class="btn btn-sm btn-outline-primary ms-2" id="refresh-ip-btn"
                                onclick="refreshProxyIP({{ account.proxy.id }})">
                                <i class="bi bi-arrow-clockwise"></i> Refresh IP
                            </button>
                            <br>
                            Status: <span
                                class="badge bg-{{ 'success' if account.proxy.status == 'active' else 'danger' }}">
                                {{ account.proxy.status }}
                            </span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Subscriptions ({{ account.subscriptions.count() }})</h5>
                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addSubscriptionModal">
                    <i class="bi bi-plus"></i> Add
                </button>
            </div>
            <div class="card-body">
                {% if account.subscriptions.count() > 0 %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Channel</th>
                                <th>Subscribed At</th>
                                <th>Source</th>
                                <th>Status</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sub in account.subscriptions %}
                            <tr>
                                <td>@{{ sub.channel_username }}</td>
                                <td>{{ sub.subscribed_at.strftime('%Y-%m-%d') }}</td>
                                <td><span class="badge bg-secondary">{{ sub.subscription_source }}</span></td>
                                <td>
                                    {% if sub.is_active %}
                                    <span class="badge bg-success">Active</span>
                                    {% else %}
                                    <span class="badge bg-secondary">Inactive</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <form method="POST"
                                        action="{{ url_for('accounts.remove_subscription', account_id=account.id, sub_id=sub.id) }}"
                                        style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">No subscriptions yet</p>
                {% endif %}
            </div>
        </div>


        <!-- WARMUP DISABLED - OLD SYSTEM
        Conversation Pairs section hidden
        Will be reimplemented in new balanced warmup system
        
        <div class="card mb-3">
            ...
        </div>
        END WARMUP DISABLED -->


        <!-- WARMUP DISABLED - OLD SYSTEM
        Recent Warmup Activity section hidden
        Will be reimplemented in new balanced warmup system
        
        {% if recent_activities %}
        <div class="card mb-3">
            ...
        </div>
        {% endif %}
        END WARMUP DISABLED -->

        <!-- NEW WARMUP SYSTEM -->
        {% include 'accounts/warmup_section.html' %}

        <!-- SCHEDULER UI -->
        {% include 'accounts/scheduler_section.html' %}
    </div>
</div>

<!-- Add Subscription Modal -->
<div class="modal fade" id="addSubscriptionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Subscription</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('accounts.add_subscription', account_id=account.id) }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="channel_username" class="form-label">Channel Username</label>
                        <input type="text" class="form-control" id="channel_username" name="channel_username"
                            placeholder="username or @username" required>
                    </div>
                    <div class="mb-3">
                        <label for="notes" class="form-label">Notes (optional)</label>
                        <textarea class="form-control" id="notes" name="notes" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Subscription</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Pair Modal -->
<div class="modal fade" id="addPairModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Conversation Pair</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('accounts.add_conversation_pair', account_id=account.id) }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="partner_id" class="form-label">Select Partner Account</label>
                        <select class="form-select" id="partner_id" name="partner_id" required>
                            <option value="">Choose an account...</option>
                            {% for other in other_accounts %}
                            <option value="{{ other.id }}">
                                {{ other.phone }}
                                {% if other.username %}(@{{ other.username }}){% endif %}
                                [{{ other.status }}]
                            </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">Both accounts must be in 'warming_up' or 'active' status.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Pair</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function refreshProxyIP(proxyId) {
        const btn = document.getElementById('refresh-ip-btn');
        const ipSpan = document.getElementById('proxy-ip');
        const originalText = btn.innerHTML;

        // Disable button and show loading
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-arrow-clockwise spinner-border spinner-border-sm"></i> Checking...';

        // Call test endpoint
        fetch(`/proxies/${proxyId}/test`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update IP display
                    ipSpan.textContent = data.ip;
                    ipSpan.classList.add('text-success', 'fw-bold');
                    setTimeout(() => {
                        ipSpan.classList.remove('text-success', 'fw-bold');
                    }, 2000);

                    // Show success message
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-success alert-dismissible fade show mt-2';
                    alert.innerHTML = `
                <strong>IP Updated!</strong> New IP: ${data.ip}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
                    ipSpan.parentElement.appendChild(alert);
                    setTimeout(() => alert.remove(), 3000);
                } else {
                    throw new Error(data.error || 'Failed to check IP');
                }
            })
            .catch(error => {
                // Show error
                const alert = document.createElement('div');
                alert.className = 'alert alert-danger alert-dismissible fade show mt-2';
                alert.innerHTML = `
            <strong>Error!</strong> ${error.message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
                ipSpan.parentElement.appendChild(alert);
                setTimeout(() => alert.remove(), 5000);
            })
            .finally(() => {
                // Re-enable button
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
    }

    // Check Account Health Function (separate from verification)
    function checkAccountHealth(method) {
        const accountId = {{ account.id }
    };
    }
    const methodNames = {
        'self_check': 'Self-Check',
        'public_channel': 'Public Channel',
        'get_me': 'Get Me'
    };

    // Show loading state
    const btn = document.querySelector('.btn-outline-success.dropdown-toggle');
    const originalText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Checking...';

    // Make AJAX request
    fetch(`/accounts/${accountId}/verify-safe`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `method=${method}`
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Success - show alert (NO reload, just health check)
                const userDisplay = data.user.username ? '@' + data.user.username : (data.user.first_name || 'ID: ' + data.user.id);
                const alert = document.createElement('div');
                alert.className = 'alert alert-success alert-dismissible fade show mt-3';
                alert.innerHTML = `
                    <strong>‚úÖ Account is Alive!</strong> Check via ${methodNames[method]} successful.
                    <br><small>Duration: ${data.duration || 'N/A'} | User: ${userDisplay}</small>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                btn.parentElement.parentElement.appendChild(alert);

                // Auto-dismiss after 10 seconds
                setTimeout(() => alert.remove(), 10000);
            } else {
                // Error - show error message
                const errorType = data.error_type || 'error';
                let alertClass = 'alert-danger';
                let icon = '‚ùå';

                if (errorType === 'cooldown') {
                    alertClass = 'alert-warning';
                    icon = '‚è±Ô∏è';
                } else if (errorType === 'flood_wait') {
                    alertClass = 'alert-warning';
                    icon = '‚ö†Ô∏è';
                }

                const alert = document.createElement('div');
                alert.className = `alert ${alertClass} alert-dismissible fade show mt-3`;
                alert.innerHTML = `
                    <strong>${icon} ${errorType === 'cooldown' ? 'Cooldown Active' : 'Error'}</strong> ${data.error}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                btn.parentElement.parentElement.appendChild(alert);

                // Auto-dismiss after 10 seconds
                setTimeout(() => alert.remove(), 10000);
            }
        })
        .catch(error => {
            // Network error
            const alert = document.createElement('div');
            alert.className = 'alert alert-danger alert-dismissible fade show mt-3';
            alert.innerHTML = `
                <strong>‚ùå Network Error!</strong> ${error.message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            btn.parentElement.parentElement.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        })
        .finally(() => {
            // Re-enable button
            btn.disabled = false;
            btn.innerHTML = originalText;
        });
    }

    // Sync Profile Logic
    function syncProfile() {
        if (!confirm('Start full profile sync? This behaves like a human checking their own profile (opening settings, scrolling, scrolling). Takes ~5-10s.')) {
            return;
        }

        const btn = document.getElementById('sync-btn');
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Syncing...';

        fetch(`/accounts/${accountId}/sync-profile`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Reload to show new data
                    location.reload();
                } else {
                    alert('‚ùå Sync Error: ' + data.error);
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            })
            .catch(err => {
                alert('‚ùå Network Error: ' + err.message);
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
    }
</script>

{% endblock %}